# 实现文档

## 团队实施

我们将 GitHub 作为代码提交工具进行协作，开展多次小组会议及集中作业，最终完成了各个模块的分工。各成员在项目中负责不同的功能模块和技术难点，采用敏捷开发模式进行分阶段开发和调试。

- **代码提交管理**：团队成员通过 Git 进行版本控制和代码提交，确保项目代码的高效管理。
- **小组会议与讨论**：通过定期的团队会议来讨论项目进展，解决技术难题，确保项目按时完成。
- **小组分工**：根据各成员的技术特长，分配了不同的模块开发任务，确保项目的高效执行。

## 小组分工



## 相关工作

项目的前期工作集中在 **文献** 和 **工具数据** 的爬取和清洗上。为了能够提供高质量的文献资源和工具信息，我们首先通过爬虫技术从各大学术网站、工具平台和相关API接口获取原始数据。爬取的数据包括文献标题、作者、发表时间、引用次数、工具名称、描述、定价方式等信息。

数据清洗是保证后期系统数据质量的关键一步。我们使用了以下技术：

- **数据格式化**：对爬取的数据进行统一格式处理，删除无效或重复的数据。
- **数据去重**：去除重复的文献和工具信息，避免展示相同内容。
- **缺失数据处理**：填补或删除缺失重要字段的数据，确保每条数据的完整性。
- **异常数据剔除**：剔除与真实数据不符的异常值，确保数据的准确性。

数据清洗的目标是确保提供给系统的数据既精准又符合业务需求，为后续的搜索、排序、推荐等功能奠定基础。

## 功能及实现

### 用户注册

#### 功能介绍

用户注册功能允许新用户创建一个账户，并获取访问系统其他功能的权限。注册过程中，用户需要提供一个有效的电子邮件地址、用户名和密码。注册过程包括数据验证、邮箱验证以及密码加密等操作。

#### 界面展示

![image-20241211225159062](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211225159062.png)

#### 代码实现

model部分定义验证规则以及与数据库的连接，同时采用哈希加密的方式对密码进行加密。

```php+HTML
class SignupForm extends Model
{
    public $username;
    public $email;
    public $password;

    // 定义验证规则
    public function rules()
    {
        return [
            [['username', 'email', 'password'], 'required'],
            ['email', 'email'],
            ['email', 'unique', 'targetClass' => '\common\models\User', 'message' => 'This email address has already been taken.'],
            ['username', 'unique', 'targetClass' => '\common\models\User', 'message' => 'This username has already been taken.'],
            ['password', 'string', 'min' => 6],
        ];
    }

    // 注册用户
    public function signup()
    {
        if ($this->validate()) {
            $user = new User();
            $user->username = $this->username;
            $user->email = $this->email;
            $user->password = Yii::$app->security->generatePasswordHash($this->password); // 密码哈希加密
            $user->auth_key = Yii::$app->security->generateRandomString(); // 生成auth_key
            $user->created_at = date('Y-m-d H:i:s', time()); // 当前时间转为DATETIME格式
            $user->updated_at = date('Y-m-d H:i:s', time()); // 当前时间转为DATETIME格式


            return $user->save() ? $user : null;
        }

        return null;
    }
}
```

view部分美化界面，背景采用轮播方式。

```php+HTML
<!-- 页面内容 -->
<div class="site-signup">
    <div class="signup-container">
        <h1><?= Html::encode($this->title) ?></h1>

        <p>Please fill out the following fields to signup:</p>

        <?php $form = ActiveForm::begin(['id' => 'form-signup']); ?>

            <?= $form->field($model, 'username')->textInput(['autofocus' => true]) ?>

            <?= $form->field($model, 'email') ?>

            <?= $form->field($model, 'password')->passwordInput() ?>

            <div class="form-group">
                <?= Html::submitButton('Signup', ['class' => 'btn btn-primary', 'name' => 'signup-button']) ?>
            </div>

        <?php ActiveForm::end(); ?>
    </div>
</div>

<!-- 背景图片轮播 -->
<div class="background-slideshow">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片1.jpg" class="active">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片2.jpg">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片3.jpg">
</div>

<!-- 图片轮播 JavaScript -->
<script>
    // 图片轮播效果
    let currentImageIndex = 0;
    const images = document.querySelectorAll('.background-slideshow img');
    const totalImages = images.length;

    setInterval(() => {
        // 移除当前图片的 active 类
        images[currentImageIndex].classList.remove('active');

        // 切换到下一个图片
        currentImageIndex = (currentImageIndex + 1) % totalImages;

        // 为下一个图片添加 active 类
        images[currentImageIndex].classList.add('active');
    }, 5000); // 每5秒切换一次图片
</script>

```

controller部分获取用户注册动作。

```php+HTML
public function actionSignup()
    {
        $model = new SignupForm();
        if ($model->load(Yii::$app->request->post()) && $model->signup()) {
            Yii::$app->session->setFlash('success', 'Thank you for registration. Please check your inbox for verification email.');
            return $this->goHome();
        }

        return $this->render('signup', [
            'model' => $model,
        ]);
    }
```

### 用户登录

#### 功能介绍

用户登录功能允许已经注册的用户输入用户名和密码进行身份验证。成功登录后，可以在用户态进行前端的交互。

#### 界面展示

![image-20241211222133492](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211222133492.png)

#### 代码实现

controller部分获取用户登录动作。

```php+HTML
public function actionLogin()
    {
        if (!Yii::$app->user->isGuest) {
            return $this->goHome();
        }

        $model = new LoginForm();
        if ($model->load(Yii::$app->request->post()) && $model->login()) {
            return $this->goBack();
        } else {
            $model->password = '';  // 清空密码字段，避免泄漏敏感信息

            return $this->render('login', [
                'model' => $model,
            ]);
        }
    }
```

view部分展示界面，和注册界面相似。

```php+HTML
<div class="site-login">
    <div class="login-container">
        <h1><?= Html::encode($this->title) ?></h1>
        <p>Please fill out the following fields to login:</p>

        <?php $form = ActiveForm::begin(['id' => 'login-form']); ?>

        <?= $form->field($model, 'username')->textInput(['autofocus' => true, 'placeholder' => 'Username']) ?>

        <?= $form->field($model, 'password')->passwordInput(['placeholder' => 'Password']) ?>

        <?= $form->field($model, 'rememberMe')->checkbox() ?>

        <div class="form-group text-center">
            <div style="color:#999;margin:1em 0">
                If you forgot your password you can <?= Html::a('reset it', ['site/request-password-reset']) ?>.
                <br>
                Need new verification email? <?= Html::a('Resend', ['site/resend-verification-email']) ?>
            </div>
        </div>

        <div class="form-group">
            <?= Html::submitButton('Login', ['class' => 'btn btn-primary', 'name' => 'login-button']) ?>
        </div>

        <?php ActiveForm::end(); ?>
    </div>
</div>

<!-- 背景图片轮播 -->
<div class="background-slideshow">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片1.jpg" class="active">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片2.jpg">
    <img src="<?= Yii::getAlias('@web') ?>/assets/images/背景图片3.jpg">
</div>

```

model部分进行规则制定与数据库表进行匹配。

```php+HTML
class LoginForm extends Model
{
    public $username;
    public $password;

    /**
     * @return array the validation rules.
     */
    public function rules()
    {
        return [
            [['username', 'password'], 'required'],  // 用户名和密码都是必填字段
            ['password', 'validatePassword'],  // 自定义密码验证
        ];
    }

    // 自定义密码验证
    public function validatePassword($attribute, $params)
    {
        $user = User::findOne(['username' => $this->username]);

        // 如果找不到该用户或密码不匹配
        if (!$user || !Yii::$app->security->validatePassword($this->password, $user->password)) {
            $this->addError($attribute, 'Invalid username or password.');
        }
    }

    /**
     * 登录功能
     * @return bool whether the user is logged in successfully
     */
    public function login()
    {
        if ($this->validate()) {
            $user = User::findOne(['username' => $this->username]);
            // 如果验证通过，则登录
            return Yii::$app->user->login($user);
        }
        return false; // 登录失败
    }
}
```

### 用户反馈

#### 功能介绍

用户反馈功能允许用户向管理员提交他们在使用系统过程中遇到的问题或提供改进建议。用户反馈通过表单提交，管理者可以在后台查看和处理这些反馈。

#### 界面展示

![image-20241211231549091](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211231549091.png)

![image-20241211231627259](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211231627259.png)

#### 代码实现

view部分进行界面展示设计。

```php+HTML
<h1>Contact Form</h1>

<!-- Contact Form -->
<?php $form = ActiveForm::begin([
    'id' => 'contact-form',
    'action' => ['site/contact'], // 表单提交到后台的接口
    'enableAjaxValidation' => false, // 不启用AJAX验证
    'options' => ['data-pjax' => 1, 'class' => 'form-horizontal'], // 启用 PJAX
]); ?>

<!-- 表单字段 -->
<?= Html::textInput('name', '', ['placeholder' => 'Your Name', 'class' => 'form-control']) ?>
<?= Html::textInput('email', '', ['placeholder' => 'Your Email', 'class' => 'form-control']) ?>
<?= Html::textInput('subject', '', ['placeholder' => 'Subject', 'class' => 'form-control']) ?>
<?= Html::textarea('body', '', ['rows' => 6, 'placeholder' => 'Your Message', 'class' => 'form-control']) ?>

<div class="form-group">
    <?= Html::submitButton('Submit', ['class' => 'btn btn-primary', 'id' => 'submit-button']) ?>
</div>

<?php ActiveForm::end(); ?>


<!-- 弹窗反馈 -->
<div id="successDialog" title="Success" style="display:none;">
    <div>Thank you for your valuable feedback!</div>
</div>

<?php
// 在JavaScript中显示弹窗
$script = <<<JS
    // 初始化 dialog 插件
    $('#successDialog').dialog({
        autoOpen: false,  // 确保初始化时不自动打开
        modal: true,      // 使用模态窗口，阻止其他操作
        buttons: {
            'OK': function() {
                location.reload();  // 页面刷新
            }
        }
    });

    $('#contact-form').on('beforeSubmit', function(e) {
        e.preventDefault(); // 阻止默认提交
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                // 处理响应，例如弹窗反馈
                if (response.success) {
                    $('#successDialog').dialog('open');  // 调用 open 打开对话框
                } else {
                    alert('Failed to submit the form.');
                }
            },
            error: function() {
                alert('Error occurred while submitting the form.');
            }
        });
        return false;
    });
    
JS;
$this->registerJs($script);
?>
```

controller部分获取用户提交动作并转接入数据库。

```php+HTML
	public function actionContact()
    {  
        // 只在表单提交时处理
        if (Yii::$app->user->isGuest) {
            Yii::$app->session->setFlash('error', 'You must be logged in to post a comment.');
            return $this->redirect(['site/login']);
        }

        if (Yii::$app->request->isPost) {
            $name = Yii::$app->request->post('name');
            $email = Yii::$app->request->post('email');
            $subject = Yii::$app->request->post('subject');
            $body = Yii::$app->request->post('body');
    
            Yii::info("Received data: name=$name, email=$email, subject=$subject, body=$body", 'contactForm');
            $createdAt = date('Y-m-d H:i:s', time());
            try {
                $sql = Yii::$app->db->createCommand()
                    ->insert('contact_form_submissions', [
                        'user_id' => Yii::$app->user->id,
                        'name' => $name,
                        'email' => $email,
                        'subject' => $subject,
                        'body' => $body,
                        'created_at' => $createdAt,
                    ])
                    ->getSql();
                
                Yii::info("Generated SQL: " . $sql, 'contactForm');
                
                Yii::$app->db->createCommand()
                    ->insert('contact_form_submissions', [
                        'user_id' => Yii::$app->user->isGuest ? null : Yii::$app->user->id,
                        'name' => $name,
                        'email' => $email,
                        'subject' => $subject,
                        'body' => $body,
                        'created_at' => $createdAt,
                    ])
                    ->execute();
                
                // 返回成功响应
                Yii::$app->response->format = \yii\web\Response::FORMAT_JSON;
                return ['success' => true];
            } catch (\Exception $e) {
                // 捕获异常，记录详细错误信息
                Yii::error("Database error: " . $e->getMessage(), 'contactForm');
                Yii::error("Stack trace: " . $e->getTraceAsString(), 'contactForm');
                
                Yii::$app->response->format = \yii\web\Response::FORMAT_JSON;
                return ['success' => false, 'message' => 'An error occurred: ' . $e->getMessage()];
            }
        }
        return $this->render('contact');
    }

```



### 团队介绍

#### 功能介绍

团队介绍模块展示了项目团队成员的基本信息，包括姓名、职务、简介和照片，帮助用户了解团队背景。

#### 界面展示

#### 代码实现

### 前端首页

#### 功能介绍

前端首页是用户进入系统后的第一个页面，展示了系统的基本功能模块。首页起到引导用户进入不同模块的作用。

#### 界面展示

#### 代码实现

### 推荐视频

#### 功能介绍

可以看到官方推荐的AI相关视频，进行快速浏览。

#### 界面展示

#### 代码实现

### 文献搜索（前端核心模块）

#### 功能介绍

支持通过搜索框输入日期查找文献，点击评论和喜欢按钮可进入文献论坛

#### 界面展示

![image-20241211232525297](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211232525297.png)

选择日期进行检索。

![image-20241211232623683](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211232623683.png)

#### 代码实现

view界面通过添加时间组件帮助搜索文献，同时提供评论和点赞按钮，进入文献论坛。

```php+HTML
<h1>Arxiv Papers</h1>

<!-- 日期检索表单 -->
<div class="search-bar">
    <?php $form = ActiveForm::begin([
        'method' => 'get',
        'action' => Url::to(['site/arxiv']), // 指向当前路由
        'options' => ['class' => 'form-inline'],
    ]); ?>
    <?= Html::input('date', 'date', $searchDate, [
        'class' => 'form-control',
        'placeholder' => 'Search by date',
    ]) ?>
    <?= Html::submitButton('Search', ['class' => 'btn btn-primary']) ?>
    <?php ActiveForm::end(); ?>
</div>

<!-- 显示论文列表 -->
<?php if (!empty($arxivPapers)): ?>
    <div class="row">
        <?php foreach ($arxivPapers as $paper): ?>
            <div class="col-lg-4">
                <div class="paper-box">
                    <p><strong>Title:</strong> <?= Html::encode($paper['title']) ?></p>
                    <p><strong>Abstract:</strong> 
                        <?php 
                        $abstractWords = explode(' ', $paper['abstract']);
                        $shortAbstract = implode(' ', array_slice($abstractWords, 0, 20)) . (count($abstractWords) > 20 ? '...' : '');
                        echo Html::encode($shortAbstract); 
                        ?>
                    </p>
                    <p><strong>Published Date:</strong> <?= Html::encode($paper['published']) ?></p>
                    <p><strong>Authors:</strong> <?= Html::encode($paper['authors']) ?></p>
                    <p><strong>URL:</strong> <a href="<?= Html::encode($paper['url']) ?>" target="_blank"><?= Html::encode($paper['url']) ?></a></p>
                    <p>
                        <a class="btn btn-default" href="<?= Url::to(['site/comment', 'paper_id' => $paper['id']]) ?>">Comments & Like</a>
                    </p>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
<?php else: ?>
    <p>No papers available for the selected date.</p>
<?php endif; ?>
```

### 国家排行（前端核心模块）

#### 功能介绍

该模块展示各国AI使用的排名。用户可以选择不同的年份查看排名情况。

#### 界面展示

![image-20241211233026035](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211233026035.png)

其中右侧是动态展示图。

![image-20241211233456650](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241211233456650.png)

#### 代码实现

view显示国家对AI利用率的排行可视化。

```
<h1>Country Ranking by Score</h1>

<!-- 下拉列表选择年份 -->
<div class="form-group">
    <label for="year-select">Select Year:</label>
    <select id="year-select" class="form-control" onchange="updateCharts()">
        <option value="">Select Year</option>
        <?php
        // 查询所有年份
        $command = Yii::$app->db->createCommand('SELECT DISTINCT year FROM country_rank ORDER BY year DESC');
        $years = $command->queryAll();
        foreach ($years as $year) {
            echo "<option value='" . $year['year'] . "'>" . $year['year'] . "</option>";
        }
        ?>
    </select>
</div>

<!-- 显示弦图和三维图容器 -->
<div class="row">
    <!-- 弦图 -->
    <div class="col-lg-6">
        <div id="chord-diagram" style="width: 100%; height: 400px;"></div>
    </div>
    <!-- 三维图 -->
    <div class="col-lg-6">
        <div id="threeD-chart" style="width: 100%; height: 600px;"></div>
    </div>
</div>

<?php
// 初始年份数据（用于页面加载时默认展示）
$initialYear = isset($years[0]['year']) ? $years[0]['year'] : '';
$initialData = [];
if ($initialYear) {
    $command = Yii::$app->db->createCommand("SELECT * FROM country_rank WHERE year = :year");
    $initialData = $command->bindValue(':year', $initialYear)->queryAll();
}

// 将初始数据传递给JS
$initialDataJson = json_encode($initialData);
?>

<script>
    // 国家和图标的映射
    var countryIcons = {
        "USA": "fa-flag",
        "China": "fa-git",
        "Germany": "fa-basketball-ball",
        "India": "fa-cogs",
        "UK": "fa-paw",  // 示例，继续添加其他国家及图标
        // ...
    };

    function updateCharts() {
        var selectedYear = document.getElementById('year-select').value;

        if (!selectedYear) {
            alert("Please select a year.");
            return;
        }

        // 发起AJAX请求获取选定年份的数据
        $.ajax({
            url: '<?= Url::to(["site/get-country-data"]) ?>',
            type: 'GET',
            data: { year: selectedYear },
            success: function(response) {
                var data = JSON.parse(response);

                // 转换数据为弦图所需的格式
                var countries = data.map(function(country) { return country.region; });
                var matrix = generateMatrix(data); // 生成弦图需要的矩阵数据

                // 更新弦图
                createChordDiagram(matrix, countries);

                // 更新三维图
                update3DChart(data);
            }
        });
    }

    // 生成弦图矩阵
    function generateMatrix(data) {
        var countries = [...new Set(data.map(function(country) { return country.region; }))];
        var matrix = [];

        countries.forEach(function(source, i) {
            matrix[i] = [];
            countries.forEach(function(target, j) {
                var value = 0;

                // 根据需要的属性来填充矩阵，例如使用citable_documents、citations等
                data.forEach(function(country) {
                    if (country.region === source) {
                        value += parseFloat(country.citable_documents);  // 这里你可以根据需求替换不同属性
                    }
                });

                matrix[i][j] = value;
            });
        });

        return matrix;
    }

    // 创建弦图
    function createChordDiagram(matrix, countries) {
        var width = 400;
        var height = 400;
        var innerRadius = Math.min(width, height) * 0.4;
        var outerRadius = innerRadius * 1.1;

        // 设置弦图的颜色
        var color = d3.scaleOrdinal(d3.schemeCategory10);

        // 设置弦图的布局
        var chord = d3.chord().padAngle(0.05).sortSubgroups(d3.descending);

        var arc = d3.arc().innerRadius(innerRadius).outerRadius(outerRadius);
        var ribbon = d3.ribbon().radius(innerRadius);

        // 清空之前的图形
        d3.select("#chord-diagram").select("svg").remove();

        var svg = d3.select("#chord-diagram").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var chords = chord(matrix);

        var group = svg.append("g")
            .selectAll("g")
            .data(chords.groups)
            .enter().append("g");

        group.append("path")
            .style("fill", function(d, i) { return color(i); })
            .style("stroke", function(d, i) { return color(i); })
            .attr("d", arc);

        group.append("text")
            .attr("transform", function(d) { 
                return "rotate(" + ((d.startAngle + d.endAngle) / 2 * 180 / Math.PI - 90) + ")translate(" + (outerRadius + 10) + ")";
            })
            .attr("dy", ".35em")
            .style("text-anchor", "middle")
            .html(function(d, i) {
                var country = countries[i];
                var iconClass = countryIcons[country] || 'fa-circle';  // 默认图标
                return `<i class="fa ${iconClass}" style="color: ${color(i)};"></i>`;  // FontAwesome图标与颜色
            });

        svg.append("g")
            .selectAll("path")
            .data(chords)
            .enter().append("path")
            .attr("d", ribbon)
            .style("fill", function(d) { return color(d.target.index); })
            .style("stroke", function(d) { return color(d.target.index); });
        
        // 添加矩形框，表示每个国家的颜色
        var legendContainer = d3.select("#chord-diagram").append("div").style("display", "flex").style("flex-direction", "column").style("margin-left", "20px");
        
        countries.forEach(function(country, i) {
            var legendItem = legendContainer.append("div").style("display", "flex").style("align-items", "center").style("margin-bottom", "5px");
            legendItem.append("div")
                .style("width", "20px")
                .style("height", "20px")
                .style("background-color", color(i))
                .style("margin-right", "10px");
            legendItem.append("span")
                .text(country)
                .style("color", "#fff")
                .style("font-size", "14px");
        });
    }

    // 更新三维图
    function update3DChart(data) {
        var countries = data.map(function(country) { return country.region; });
        var regions = data.map(function(country) { return country.region; });

        // 提取不同属性数据
        var documents = data.map(function(country) { return parseFloat(country.documents); });
        var citableDocuments = data.map(function(country) { return parseFloat(country.citable_documents); });
        var citations = data.map(function(country) { return parseFloat(country.citations); });
        var selfCitations = data.map(function(country) { return parseFloat(country.self_citations); });
        var citationsPerDocument = data.map(function(country) { return parseFloat(country.citations_per_document); });
        var hIndex = data.map(function(country) { return parseFloat(country.h_index); });

        // 定义不同颜色
        var colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b'];

        // 为不同的属性创建多个系列
        var traces = [
            {
                x: countries,
                y: regions,
                z: documents,
                mode: 'markers',
                marker: { size: 10, color: '#1f77b4' },
                name: 'Documents',
                type: 'scatter3d'
            },
            {
                x: countries,
                y: regions,
                z: citableDocuments,
                mode: 'markers',
                marker: { size: 10, color: '#ff7f0e' },
                name: 'Citable Documents',
                type: 'scatter3d'
            },
            {
                x: countries,
                y: regions,
                z: citations,
                mode: 'markers',
                marker: { size: 10, color: '#2ca02c' },
                name: 'Citations',
                type: 'scatter3d'
            },
            {
                x: countries,
                y: regions,
                z: selfCitations,
                mode: 'markers',
                marker: { size: 10, color: '#d62728' },
                name: 'Self Citations',
                type: 'scatter3d'
            },
            {
                x: countries,
                y: regions,
                z: citationsPerDocument,
                mode: 'markers',
                marker: { size: 10, color: '#9467bd' },
                name: 'Citations per Document',
                type: 'scatter3d'
            },
            {
                x: countries,
                y: regions,
                z: hIndex,
                mode: 'markers',
                marker: { size: 10, color: '#8c564b' },
                name: 'H-index',
                type: 'scatter3d'
            }
        ];

        // 设置图表布局
        var layout = {
            scene: {
                xaxis: { title: 'Country' },
                yaxis: { title: 'Region' },
                zaxis: { title: 'Metrics' }
            },
            title: '3D Scatter Plot of Country Metrics'
        };

        // 清空之前的图形
        Plotly.newPlot('threeD-chart', traces, layout);
    }

    // 页面加载时，如果有初始数据，渲染弦图和三维图
    <?php if ($initialYear): ?>
        document.addEventListener('DOMContentLoaded', function() {
            updateCharts();  // 更新弦图和三维图
        });
    <?php endif; ?>
</script>
```



### 工具搜索（前端核心模块）

#### 功能介绍

可以搜索AI工具，点击评论和点赞按钮进入工具论坛。

#### 界面展示

#### 代码实现

view部分展示工具搜索框，以及评论点赞按钮，进入AI工具交流论坛。

```
<h1>AI 工具列表</h1>

<!-- 筛选工具状态 -->
<div class="search-bar">
    <?php $form = ActiveForm::begin([
        'method' => 'get',
        'action' => Url::to(['site/ai_tool']),
        'options' => ['class' => 'form-inline'],
    ]); ?>
    <?= Html::textInput('tool_status', null, ['class' => 'form-control', 'placeholder' => '请输入工具状态（如：Free、Paid等）']) ?>
    <?= Html::submitButton('搜索', ['class' => 'btn btn-primary']) ?>
    <?php ActiveForm::end(); ?>
</div>

<!-- 工具列表 -->
<?php if (empty($tools)): ?>
    <p>没有找到任何工具。</p>
<?php else: ?>
    <div class="row">
        <?php foreach ($tools as $tool): ?>
            <div class="col-lg-4">
                <div class="paper-box">
                    <h3><?= Html::encode($tool['AI Tool Name']) ?></h3>
                    <p><strong>描述：</strong> <?= Html::encode($tool['Description']) ?></p>
                    <p><strong>免费/付费：</strong> <?= Html::encode($tool['Free/Paid/Other']) ?></p>
                    <p><strong>适用领域：</strong> <?= Html::encode($tool['Useable For']) ?></p>
                    <p>
                        <!-- 添加评论按钮，点击后跳转到评论页面 -->
                        <a class="btn btn-default" href="<?= Url::to(['site/toolcomment', 'tool_name' => $tool['AI Tool Name']]) ?>">评论 & 点赞</a>
                    </p>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
<?php endif; ?>

```



### 文献论坛（项目功能模块）

#### 功能介绍

展示详情和论坛，同时提供点赞功能，只用登录的用户可以进行论坛交流。

#### 界面展示

![image-20241212001056683](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241212001056683.png)

![image-20241212001308402](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241212001308402.png)

![image-20241212001343694](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241212001343694.png)

#### 代码实现

view部分展示设计界面。

```php+HTML
<h1>Paper Details</h1>
<!-- 展示论文详情 -->
<p><strong>Title:</strong> <?= Html::encode($paper['title']) ?></p>
<p><strong>Abstract:</strong> <?= Html::encode($paper['abstract']) ?></p>
<p><strong>Published:</strong> <?= Html::encode($paper['published']) ?></p>
<p><strong>Authors:</strong> <?= Html::encode($paper['authors']) ?></p>
<p><strong>URL:</strong> <a href="<?= Html::encode($paper['url']) ?>" target="_blank"><?= Html::encode($paper['url']) ?></a></p>

<hr>

<h2>Comments</h2>
<!-- 评论区 -->
<?php if (!empty($comments)): ?>
    <?php foreach ($comments as $comment): ?>
        <div class="comment-box style="background-color: rgba(249, 249, 249, 0.8);">
            <p><strong>User:</strong> <?= Html::encode($comment->user->username) ?></p>
            <p><strong>Comment:</strong> <?= Html::encode($comment->content) ?></p>
            <p><strong>Posted at:</strong> <?= date('Y-m-d H:i:s', $comment->created_at) ?></p>
        </div>
        
    <?php endforeach; ?>
<?php else: ?>
    <p>No comments yet.</p>
<?php endif; ?>

<hr>
<h2>Like this tool</h2>
<?php
// 获取当前工具名称
$paperId = $paper['id'];

// 获取点赞数
$likesCount = Yii::$app->db->createCommand('SELECT COUNT(*) FROM paper_likes WHERE paper_id = :paper_id', [':paper_id' => $paperId])->queryScalar();
?>

<p><strong>Likes:</strong> <span id="like-count"><?= $likesCount ?></span></p>

<!-- 点赞按钮 -->
<button id="like-button" class="btn btn-success">Like</button>
<hr>

<h2>Post a Comment</h2>
<?php $form = ActiveForm::begin([
    'id' => 'comment-form',
    'action' => ['site/add-comment'],
    'enableAjaxValidation' => false, // 不启用AJAX验证
    'options' => ['data-pjax' => 1, 'class' => 'form-horizontal'], // 启用 PJAX
]); ?>

<!-- 隐藏论文 ID，确保评论与论文关联 -->
<?= Html::hiddenInput('Comment[paper_id]', $paper['id']) ?>

<?= $form->field($commentModel, 'content')->textarea([
    'rows' => 4,
    'placeholder' => 'Write your comment here...'
])->label(false) ?>

<div class="form-group">
    <?= Html::submitButton('Post Comment', ['class' => 'btn btn-primary', 'id' => 'submit-button']) ?>
</div>

<?php ActiveForm::end(); ?>



<!-- 弹窗反馈 -->
<div id="successDialog" title="Success" style="display:none;">
    
    <div>Your comment has been successfully posted!</div>
</div>

<?php
// 在JavaScript中显示弹窗
$script = <<<JS
    // 初始化 dialog 插件
    $('#successDialog').dialog({
        autoOpen: false,  // 确保初始化时不自动打开
        modal: true,      // 使用模态窗口，阻止其他操作
        buttons: {
            'OK': function() {
                //$(this).dialog('close');
                location.reload();  // 页面刷新
            }
        }        
    });

    $('#comment-form').on('beforeSubmit', function(e) {
        e.preventDefault(); // 阻止默认提交
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                // 处理响应，例如弹窗反馈
                if (response.success) {
                    $('#successDialog').dialog('open');  // 调用 open 打开对话框
                } else {
                    alert('Failed to post comment.');
                }
            },
            error: function() {
                alert('Error occurred while posting the comment.');
            }
        });
        return false;
    });

    $(document).ready(function(){
    // 点赞操作
    $('#like-button').on('click', function() {
        var paperId = '$paperId';  // 获取当前工具名称
        // 发送点赞请求到后端
        $.ajax({
            url: '/site/like-paper',  // 后端点赞接口
            type: 'POST',
            data: { paper_id: paperId },
            success: function(response) {
                console.log(response);
                console.log('Paper ID:', paperId);
                if (response.success) {
                    alert('Thank for your like!');
                    // 更新点赞数
                    $('#like-count').text(response.likes_count);
                    // 切换按钮颜色
                    $('#like-button').addClass('liked');
                } else {
                    alert(response.message);  // 点赞失败的提示
                }
            },
            error: function() {
                alert('Error occurred while liking the paper.');
            }
        });
    });
});
JS;
$this->registerJs($script);

?>
```

controller获取用户的评论，展示论坛内容，获取用户点赞，输出点赞数。

```php+HTML
	public function actionComment($paper_id)
    {
        // 从数据库获取论文信息
        $paper = Yii::$app->db->createCommand('SELECT * FROM arxiv_papers WHERE id = :id')
        ->bindValue(':id', $paper_id)
        ->queryOne();

        if (!$paper) {
            throw new \yii\web\NotFoundHttpException('Paper not found.');
        }

        // 使用 Comment 模型获取与该论文相关的评论
        $comments = Comment::find()->where(['paper_id' => $paper_id])->all();

        // 创建一个新的 Comment 模型用于表单
        $commentModel = new Comment();

        // 渲染评论页面，并传递论文和评论数据
        return $this->render('comment', [
            'paper' => $paper,         // 传递论文详细信息
            'comments' => $comments,  // 评论数据
            'commentModel' => $commentModel,  // 评论模型
        ]);
    }

    public function actionAddComment()
    {
        // 检查用户是否登录
        if (Yii::$app->user->isGuest) {
            Yii::$app->session->setFlash('error', 'You must be logged in to post a comment.');
            return $this->redirect(['site/login']);  // 如果未登录，重定向到登录页面
        }

        $comment = new Comment();

        // 加载表单数据到 Comment 模型
        if ($comment->load(Yii::$app->request->post())) {

            // 检查 paper_id 是否有效
            $paper = Yii::$app->db->createCommand('SELECT * FROM arxiv_papers WHERE id = :id')
            ->bindValue(':id', $comment->paper_id)
            ->queryOne();

            if (!$paper) {
                Yii::$app->session->setFlash('error', 'Invalid paper ID.');
                return $this->redirect(['site/comment', 'paper_id' => $comment->paper_id]);
            }

            
            // 设置评论的创建时间（当前时间戳）
            $comment->created_at = time();
            
            // 获取当前登录用户的 ID 和用户名
            $comment->user_id = Yii::$app->user->id;  // 当前用户的 ID
            
            // 保存评论
            if ($comment->save()) {
                
                if (Yii::$app->request->isAjax) {
                    return $this->asJson(['success' => true]);
                }
                Yii::$app->session->setFlash('success', 'Comment added successfully.');

            } else {
                
            
                //Yii::error('Error saving comment: ' . json_encode($comment->errors), __METHOD__);
                if (Yii::$app->request->isAjax) {
                    return $this->asJson(['success' => false]);
                }
                Yii::$app->session->setFlash('error', 'Failed to add comment.');  
            }
        }
        return $this->render('comment');
    }

    public function actionLikePaper()
    {
        if (Yii::$app->user->isGuest) {
            Yii::$app->session->setFlash('error', 'You must be logged in to post a comment.');
            return $this->redirect(['site/login']);
        }

        $userId = Yii::$app->user->id;  // 获取当前用户 ID
        $paperId = Yii::$app->request->post('paper_id');  // 获取论文 ID

        // 检查用户ID和论文ID是否有效
        if (!$userId || !$paperId) {
            return $this->asJson(['success' => false, 'message' => 'User ID or Paper ID is missing.']);
        }

        try {
            // 插入点赞记录到数据库
            Yii::$app->db->createCommand()->insert('paper_likes', [
                'user_id' => $userId,
                'paper_id' => $paperId,
                'created_at' => new \yii\db\Expression('NOW()'),  // 当前时间
            ])->execute();
            
            Yii::info("Inserted like record for Paper ID: $paperId, User ID: $userId", __METHOD__);

            // 获取更新后的点赞数
            $likesCount = Yii::$app->db->createCommand('SELECT COUNT(*) FROM paper_likes WHERE paper_id = :paper_id', [':paper_id' => $paperId])->queryScalar();

            Yii::info("Likes count for Paper ID: $paperId updated to: $likesCount", __METHOD__);

            // 获取更新后的点赞数
            //$likesCount = Yii::$app->db->createCommand('SELECT COUNT(*) FROM paper_likes WHERE paper_id = :paper_id', [':paper_id' => $paperId])->queryScalar();

            // 返回点赞数
            return $this->asJson([
                'success' => true,
                'likes_count' => $likesCount,  // 返回更新后的点赞数
            ]);
        } catch (\Exception $e) {
            Yii::error("Error occurred while liking paper $paperId: " . $e->getMessage(), __METHOD__);
            return $this->asJson(['success' => false, 'message' => 'You have liked this paper!']);
        }
    }
}
```

model部分负责和数据库连接。

```php+HTML
<?php
namespace frontend\models;
use Yii;
use yii\base\Model;
use yii\db\ActiveRecord;
use common\models\User;  // 引入位于 common/models/User.php 的 User 模型


class Comment extends ActiveRecord
{
    public static function tableName()
    {
        return 'comment';  // 对应数据库中的 `comment` 表
    }

    public function rules()
    {
        return [
            [['paper_id', 'user_id', 'content'], 'required'],  // 必填字段
            [['paper_id', 'user_id'], 'integer'],             // paper_id 和 user_id 为整数
            [['content'], 'string'],                          // 评论内容为字符串
            [['created_at'], 'integer'],                      // 创建时间为时间戳
        ];
    }

    // 定义与 User 模型的关系
    public function getUser()
    {
        return $this->hasOne(User::class, ['id' => 'user_id']);
    }   
}
```



### 工具论坛（项目功能模块）

#### 功能介绍

展示AI工具的详情，可以论坛交流，点赞，登录检查。

#### 界面展示

![image-20241212002146818](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241212002146818.png)

![image-20241212002307993](C:\Users\30385\AppData\Roaming\Typora\typora-user-images\image-20241212002307993.png)

#### 代码实现

view部分展示界面。

```
<h1>Tool Details</h1>
<!-- 展示工具详情 -->
<p><strong>Name:</strong> <?= Html::encode($tool['AI Tool Name']) ?></p>
<p><strong>Description:</strong> <?= Html::encode($tool['Description']) ?></p>
<p><strong>Free/Paid/Other:</strong> <?= Html::encode($tool['Free/Paid/Other']) ?></p>
<p><strong>Usable For:</strong> <?= Html::encode($tool['Useable For']) ?></p>
<p><strong>Charges:</strong> <?= Html::encode($tool['Charges']) ? Html::encode($tool['Charges']) : 'Free' ?></p>
<p><strong>Review:</strong> <?= Html::encode($tool['Review']) ? Html::encode($tool['Review']) : 'No reviews yet' ?></p>
<p><strong>Tool Link:</strong> <a href="<?= Html::encode($tool['Tool Link']) ?>" target="_blank"><?= Html::encode($tool['Tool Link']) ?></a></p>
<p><strong>Major Category:</strong> <?= Html::encode($tool['Major Category']) ?></p>

<hr>

<h2>Like this tool</h2>
<?php
// 获取当前工具名称
$toolName = $tool['AI Tool Name'];

// 获取点赞数
$likesCount = Yii::$app->db->createCommand('SELECT COUNT(*) FROM tool_likes WHERE tool_name = :tool_name', [':tool_name' => $toolName])->queryScalar();
?>

<p><strong>Likes:</strong> <span id="like-count"><?= $likesCount ?></span></p>

<!-- 点赞按钮 -->
<button id="like-button" class="btn btn-success">Like</button>
<hr>

<h2>Comments</h2>
<!-- 评论区 -->
<?php if (!empty($comments)): ?>
    <?php foreach ($comments as $comment): ?>
        <div class="comment-box">
            <p><strong>User:</strong> <?= Html::encode($comment->user->username) ?></p>
            <p><strong>Comment:</strong> <?= Html::encode($comment->content) ?></p>
            <p><strong>Posted at:</strong> <?= date('Y-m-d H:i:s', $comment->created_at) ?></p>
        </div>
        
    <?php endforeach; ?>
<?php else: ?>
    <p>No comments yet.</p>
<?php endif; ?>

<hr>

<h2>Post a Comment</h2>
<?php $form = ActiveForm::begin([
    'id' => 'comment-form',
    'action' => ['site/add-tool-comment'],
    'enableAjaxValidation' => false, // 不启用AJAX验证
    'options' => ['data-pjax' => 1, 'class' => 'form-horizontal'], // 启用 PJAX
]); ?>

<!-- 隐藏工具名称，确保评论与工具关联 -->
<?= Html::hiddenInput('ToolComment[tool_name]', $tool['AI Tool Name']) ?>

<?= $form->field($commentModel, 'content')->textarea([
    'rows' => 4,
    'placeholder' => 'Write your comment here...'
])->label(false) ?>

<div class="form-group">
    <?= Html::submitButton('Post Comment', ['class' => 'btn btn-primary', 'id' => 'submit-button']) ?>
</div>

<?php ActiveForm::end(); ?>

<!-- 弹窗反馈 -->
<div id="successDialog" title="Success" style="display:none;">
    <div>Your comment has been successfully posted!</div>
</div>

<?php
// 在JavaScript中显示弹窗
$script = <<<JS
    // 初始化 dialog 插件
    $('#successDialog').dialog({
        autoOpen: false,  // 确保初始化时不自动打开
        modal: true,      // 使用模态窗口，阻止其他操作
        buttons: {
            'OK': function() {
                $(this).dialog('close');
                location.reload();  // 页面刷新
            }
        }
    });

    $('#comment-form').on('beforeSubmit', function(e) {
        e.preventDefault(); // 阻止默认提交
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                // 处理响应，例如弹窗反馈
                if (response.success) {
                    $('#successDialog').dialog('open');  // 调用 open 打开对话框
                } else {
                    alert('Failed to post comment.');
                }
            },
            error: function() {
                alert('Error occurred while posting the comment.');
            }
        });
        return false;
    });

    $(document).ready(function(){
    // 点赞操作
    $('#like-button').on('click', function() {
        var toolName = '$toolName';  // 获取当前工具名称
        $.ajax({
            url: '/site/like',  // 后端点赞接口
            type: 'POST',
            data: { tool_name: toolName },
            success: function(response) {
                if (response.success) {
                    alert('Thank for your like!');
                    // 更新点赞数
                    $('#like-count').text(response.likes_count);
                    // 切换按钮颜色
                    $('#like-button').addClass('like');
                } else {
                    alert(response.message);  // 点赞失败的提示
                }
            },
            error: function() {
                alert('Error occurred while liking the tool.');
            }
        });
    });
});
```

controller部分获取用户评论和点赞，响应用户任务。

```php+HTML
	public function actionToolcomment($tool_name)
    {
        // 获取工具详情
        $tool = Yii::$app->db->createCommand('SELECT * FROM all_ai_tool WHERE `AI Tool Name` = :tool_name')
        ->bindValue(':tool_name', $tool_name)
        ->queryOne();

        if (!$tool) {
            throw new \yii\web\NotFoundHttpException('Tool not found.');
        }

        // 获取与该工具相关的评论
        $comments = ToolComment::find()->where(['tool_name' => $tool_name])->all();

        // 创建一个新的评论模型用于表单
        $commentModel = new ToolComment();

        return $this->render('toolcomment', [
            'tool' => $tool,
            'comments' => $comments,
            'commentModel' => $commentModel,
        ]);
    }

    public function actionAddToolComment()
    {
        if (Yii::$app->user->isGuest) {
            Yii::$app->session->setFlash('error', 'You must be logged in to post a comment.');
            return $this->redirect(['site/login']);
        }

        $comment = new ToolComment();

        if ($comment->load(Yii::$app->request->post())) {
            $comment->user_id = Yii::$app->user->id;
            $comment->created_at = time();

            // 保存评论
            if ($comment->save()) {
                
                if (Yii::$app->request->isAjax) {
                    return $this->asJson(['success' => true]);
                }
                Yii::$app->session->setFlash('success', 'Comment added successfully.');

            } else {
                
            
                //Yii::error('Error saving comment: ' . json_encode($comment->errors), __METHOD__);
                if (Yii::$app->request->isAjax) {
                    return $this->asJson(['success' => false]);
                }
                Yii::$app->session->setFlash('error', 'Failed to add comment.');
                
            }
        }

        return $this->render('toolcomment');
    }
    
	public function actionLike()
    {
        if (Yii::$app->user->isGuest) {
            Yii::$app->session->setFlash('error', 'You must be logged in to post a comment.');
            return $this->redirect(['site/login']);
        }
        
        $userId = Yii::$app->user->id;  // 获取当前用户 ID
        $toolName = Yii::$app->request->post('tool_name');  // 获取工具名称

        if (!$userId || !$toolName) {
            return $this->asJson(['success' => false, 'message' => 'User ID or Tool Name is missing.']);
        }
        try {
            // 插入点赞记录到数据库
            Yii::$app->db->createCommand()->insert('tool_likes', [
                'user_id' => $userId,
                'tool_name' => $toolName,
                'created_at' => time(),  // 当前时间
            ])->execute();

            // 获取更新后的点赞数
            $likesCount = Yii::$app->db->createCommand('SELECT COUNT(*) FROM tool_likes WHERE tool_name = :tool_name', [':tool_name' => $toolName])->queryScalar();

            // 返回点赞数
            return $this->asJson([
                'success' => true,
                'likes_count' => $likesCount,  // 返回更新后的点赞数
            ]);
        } catch (\Exception $e) {
            return $this->asJson(['success' => false, 'message' => 'You have liked this tool!']);
        }
    }
	
```



### 后端首页

#### 功能介绍

管理员可登录后端对数据进行管理，同时可视化数据库数据状态以及前端交互的数据状态。

#### 界面展示

#### 代码实现

controller

```php+HTML
public function actionIndex()
    {
        // 获取前五名点赞数最多的论文，连接 ArxivPaper 表获取论文名称
        $topPapers = PaperLike::find()
            ->select(['paper_likes.paper_id', 'COUNT(*) as likes_count'])
            ->joinWith('paper') // 通过关联关系连接 ArxivPaper 表
            ->groupBy('paper_likes.paper_id') // 按照 paper_id 分组
            ->orderBy(['likes_count' => SORT_DESC]) // 按照点赞数降序排序
            ->limit(5) // 获取前五名
            ->asArray() // 返回数组形式
            ->all();
    
        // 获取对应的论文名称和点赞数
        $paperTitles = [];
        $paperLikes = [];
        foreach ($topPapers as $paper) {
            $paperTitles[] = $paper['paper']['title']; // 获取论文标题
            $paperLikes[] = $paper['likes_count']; // 获取论文点赞数
        }
    
        // 获取前五名评论数最多的论文
        $topPaperComments = Comment::find()
            ->select(['comment.paper_id', 'COUNT(*) as comment_count', 'arxiv_papers.title as paper_title']) // 使用 arxiv_papers.title 而不是 paper.title
            ->joinWith('paper') // 通过关联关系连接 arxiv_papers 表
            ->groupBy('comment.paper_id') // 按照 paper_id 分组
            ->orderBy(['comment_count' => SORT_DESC]) // 按照评论数降序排序
            ->limit(5) // 获取前五名评论数最多的论文
            ->asArray() // 返回数组形式
            ->all();
    
        // 获取对应的论文名称和评论数
        $paperCommentTitles = [];
        $paperCommentCounts = [];
        foreach ($topPaperComments as $comment) {
            $paperCommentTitles[] = $comment['paper_title']; // 获取论文标题
            $paperCommentCounts[] = $comment['comment_count']; // 获取论文的评论数
        }
    
        // 获取前五名评论数最多的工具
        $topToolComments = ToolComment::find()
            ->select(['tool_comments.tool_name', 'COUNT(*) as comment_count'])
            ->groupBy('tool_comments.tool_name') // 按照 tool_name 分组
            ->orderBy(['comment_count' => SORT_DESC]) // 按照评论数降序排序
            ->limit(5) // 获取前五名评论数最多的工具
            ->asArray() // 返回数组形式
            ->all();
    
        // 获取对应的工具名称和评论数
        $toolCommentNames = [];
        $toolCommentCounts = [];
        foreach ($topToolComments as $tool) {
            $toolCommentNames[] = $tool['tool_name']; // 获取工具名称
            $toolCommentCounts[] = $tool['comment_count']; // 获取工具评论数
        }
    
        // 获取前五名点赞数最多的工具
        $topTools = ToolLike::find()
            ->select(['tool_likes.tool_name', 'COUNT(*) as likes_count'])
            ->groupBy('tool_likes.tool_name') // 按照 tool_name 分组
            ->orderBy(['likes_count' => SORT_DESC]) // 按照点赞数降序排序
            ->limit(5) // 获取前五名
            ->asArray() // 返回数组形式
            ->all();
    
        // 获取对应的工具名称和点赞数
        $toolNames = [];
        $toolLikes = [];
        foreach ($topTools as $tool) {
            $toolNames[] = $tool['tool_name']; // 获取工具名称
            $toolLikes[] = $tool['likes_count']; // 获取工具点赞数
        }
    
        // 准备传递给视图的数据
        $data = [
            'paperTitles' => $paperTitles,  // 使用正确的变量名称
            'paperLikes' => $paperLikes,
            'paperCommentCounts' => $paperCommentCounts,
            'paperCommentTitles' => $paperCommentTitles,
            'toolNames' => $toolNames,
            'toolLikes' => $toolLikes,
            'toolComments' => $toolCommentCounts,
            'toolCommentNames' => $toolCommentNames,
        ];    
        return $this->render('index', $data); // 将数据传递到视图
    }
    
    public function actionPaperManagement()
    {
        $papers = ArxivPaper::find()->all();
        return $this->render('paper-management', ['papers' => $papers]);
    }

public function actionAddPaper()
{
    $paper = new ArxivPaper();

    if ($paper->load(Yii::$app->request->post()) && $paper->save()) {
        Yii::$app->session->setFlash('success', 'Paper added successfully');
        return $this->redirect(['site/paper-management']);
    }

    return $this->render('add-paper', [
        'paper' => $paper,
    ]);
}

public function actionDeletePaper($id)
{
    $paper = ArxivPaper::findOne($id);

    if ($paper) {
        $paper->delete();
        Yii::$app->session->setFlash('success', 'Paper deleted successfully');
    } else {
        Yii::$app->session->setFlash('error', 'Paper not found');
    }

    return $this->redirect(['site/paper-management']);
}
   


public function actionToolManagement()
{
    // 查询所有 AI 工具数据
    $query = AllAiTool::find();

    // 创建分页对象
    $pagination = new Pagination([
        'defaultPageSize' => 10,  // 每页显示10条数据
        'totalCount' => $query->count(),  // 总记录数
    ]);

    // 根据分页对象限制查询结果
    $tools = $query->offset($pagination->offset)
                   ->limit($pagination->limit)
                   ->all();

    // 渲染视图，并传递分页对象和数据
    return $this->render('tool-management', [
        'tools' => $tools,
        'pagination' => $pagination,
    ]);
}
public function actionAddTool()
{
    $model = new AllAiTool();

    if ($model->load(Yii::$app->request->post()) && $model->validate()) {
        // 确保数据完整
        if (!empty($model->aiToolName)) {
            $model->save(false); // 保存数据到数据库
            Yii::$app->session->setFlash('success', 'AI Tool added successfully.');
            return $this->redirect(['tool-management']);
        } else {
            Yii::$app->session->setFlash('error', 'AI Tool Name is required.');
        }
    }

    return $this->render('add-tool', ['model' => $model]);
}

public function actionDeleteTool($toolName)
{
    // 使用主键 'AI Tool Name' 查找对应的记录
    $tool = AllAiTool::findOne(['AI Tool Name' => $toolName]);

    if ($tool) {
        // 删除记录
        $tool->delete();
        Yii::$app->session->setFlash('success', 'Tool deleted successfully');
    } else {
        // 如果找不到记录，显示错误消息
        Yii::$app->session->setFlash('error', 'Tool not found');
    }

    // 重定向回工具管理页面
    return $this->redirect(['site/tool-management']);
}
```

view

```php+HTML
<div class="admin-dashboard">

    <!-- 顶部导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#" style="color: white;">Admin Dashboard</a>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3 bg-light sidebar">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="<?= \yii\helpers\Url::to(['site/index']) ?>">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="<?= \yii\helpers\Url::to(['comment/select-type']) ?>">Comment Management</a>
                        <!-- 子菜单 -->
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="<?= \yii\helpers\Url::to(['comment/ai-tool']) ?>">AI Tool Comments</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="<?= \yii\helpers\Url::to(['comment/paper']) ?>">Paper Comments</a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="<?= \yii\helpers\Url::to(['post/select-type']) ?>">Likes Management</a>
                        <!-- 子菜单 -->
                        <ul class="nav flex-column ml-3">
                            <li class="nav-item">
                                <a class="nav-link" href="<?= \yii\helpers\Url::to(['post/ai-tool']) ?>">AI Tool Likes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="<?= \yii\helpers\Url::to(['post/paper']) ?>">Paper Likes</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="<?= \yii\helpers\Url::to(['user/user-management']) ?>">User Management</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="<?= \yii\helpers\Url::to(['site/paper-management']) ?>">Paper Management</a>
                        <a class="nav-link" href="<?= \yii\helpers\Url::to(['site/tool-management']) ?>">AI Tool Management</a>                    </li>
                </ul>
            </div>

            <!-- 主要内容区域 -->
            <div class="col-md-9 move-up">
                <div class="jumbotron">
                    <div class="container">
                        <!-- Paper Likes 饼状图 -->
                        <div class="col-md-6">
                            <h3>Paper Likes</h3>
                                <div style="width: 300px; height: 300px; margin: 0 auto;"> <!-- 调整大小 -->
                                    <canvas id="paperLikesPieChart"></canvas>
                                </div>
                        </div>

                        <!-- Paper Comments 饼状图 -->
                        <div class="col-md-6">
                            <h3>Paper Comments</h3>
                            <div style="width: 300px; height: 300px; margin: 0 auto;"> <!-- 调整大小 -->
                                <canvas id="paperCommentsPieChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="container">
                        <!-- AI Tool Likes -->
                        <div class="col-md-6">
                            <h3>AI Tool Likes</h3>
                            <canvas id="aiToolLikesChart"></canvas> <!-- AI Tool Likes Chart -->
                        </div>

                        <!-- AI Tool Comments -->
                        <div class="col-md-6">
                            <h3>AI Tool Comments</h3>
                            <canvas id="aiToolCommentsChart"></canvas> <!-- AI Tool Comments Chart -->
                        </div>
                    </div>
                </div>

                <!-- 三个卡片并排显示 -->
                <div class="row">
                    <!-- 评论管理 -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Comment Management
                            </div>
                            <div class="card-body">
                                <p>Select the type of comments you want to manage:</p>
                                <a href="<?= \yii\helpers\Url::to(['comment/select-type']) ?>" class="btn btn-primary">Go to Comment Management</a>
                            </div>
                        </div>
                    </div>

                    <!-- 点赞数管理 -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Likes Management
                            </div>
                            <div class="card-body">
                                <p>Manage the number of likes for each post. Reset, increase, or decrease likes as needed.</p>
                                <a href="<?= \yii\helpers\Url::to(['post/select-type']) ?>" class="btn btn-primary">Go to Likes Management</a>
                            </div>
                        </div>
                    </div>

                    <!-- 用户管理 -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                User Management
                            </div>
                            <div class="card-body">
                                <p>Manage front-end users, including viewing profiles, disabling accounts, and more.</p>
                                <a href="<?= \yii\helpers\Url::to(['user/user-management']) ?>" class="btn btn-primary">Go to User Management</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- 引入Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

<!-- 引入chartjs-plugin-wordcloud -->
<!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-wordcloud"></script> -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-wordcloud"></script>

<?php
$filteredPaperTitles = array_map(function ($title) {
    $words = explode(' ', $title);
    return $words[0]; // 仅保留标题的第一个单词
}, $paperTitles);

$filteredCommentTitles = array_map(function ($title) {
    $words = explode(' ', $title);
    return $words[0]; // 仅保留标题的第一个单词
}, $paperCommentTitles);
?>

<script>
window.onload = function () {
    // 计算 Paper Likes 数据占比
    var paperLikesData = <?= json_encode($paperLikes) ?>;
    var filteredTitlesForLikes = <?= json_encode($filteredPaperTitles) ?>;
    var filteredLikes = paperLikesData.filter(count => count > 0); // 过滤点赞数为0的文章
    var paperLikesTotal = filteredLikes.reduce((a, b) => a + b, 0); // 总点赞数
    var paperLikesPercentage = filteredLikes.map(function (count) {
        return ((count / paperLikesTotal) * 100).toFixed(2); // 百分比计算并保留两位小数
    });

    // Paper Likes 饼状图
    var ctx1 = document.getElementById('paperLikesPieChart').getContext('2d');
    var paperLikesPieChart = new Chart(ctx1, {
        type: 'pie',
        data: {
            labels: filteredTitlesForLikes, // 使用过滤后的标题
            datasets: [{
                label: 'Percentage of Likes (%)',
                data: paperLikesPercentage,
                backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff', '#ff9f40'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            var label = tooltipItem.label || '';
                            var value = tooltipItem.raw || 0;
                            return label + ': ' + value + '%'; // 显示百分比
                        }
                    }
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            }
        }
    });

    // 计算 Paper Comments 数据占比
    var paperCommentsData = <?= json_encode($paperCommentCounts) ?>;
    var filteredTitlesForComments = <?= json_encode($filteredCommentTitles) ?>;
    var filteredComments = paperCommentsData.filter(count => count > 0); // 过滤评论数为0的文章
    var paperCommentsTotal = filteredComments.reduce((a, b) => a + b, 0); // 总评论数
    var paperCommentsPercentage = filteredComments.map(function (count) {
        return ((count / paperCommentsTotal) * 100).toFixed(2); // 百分比计算并保留两位小数
    });

    // Paper Comments 饼状图
    var ctx2 = document.getElementById('paperCommentsPieChart').getContext('2d');
    var paperCommentsPieChart = new Chart(ctx2, {
        type: 'pie',
        data: {
            labels: filteredTitlesForComments, // 使用过滤后的标题
            datasets: [{
                label: 'Percentage of Comments (%)',
                data: paperCommentsPercentage,
                backgroundColor: ['#4bc0c0', '#9966ff', '#ff9f40', '#ff6384', '#36a2eb', '#ffce56'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            var label = tooltipItem.label || '';
                            var value = tooltipItem.raw || 0;
                            return label + ': ' + value + '%'; // 显示百分比
                        }
                    }
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            }
        }
    });
};
</script>


<!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-wordcloud"></script> -->

<script>
 

    // AI Tool Likes Chart
    var ctx3 = document.getElementById('aiToolLikesChart').getContext('2d');
    var aiToolLikesChart = new Chart(ctx3, {
        type: 'bar',
        data: {
            labels: <?= json_encode($toolNames) ?>, // 从控制器传递的数据
            datasets: [{
                label: 'Likes Count',
                data: <?= json_encode($toolLikes) ?>, // 从控制器传递的数据
                backgroundColor: '#007bff', // Blue for Likes
                borderColor: '#0056b3',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return tooltipItem.dataset.label + ': ' + tooltipItem.raw;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true
                }
            }
        }
    });

// Paper Comments Chart
var ctx2 = document.getElementById('aiToolCommentsChart').getContext('2d');
var paperCommentsChart = new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: <?= json_encode($toolCommentNames) ?>, // 传递的 tool-name 数据
        datasets: [{
            label: 'Comments Count',
            data: <?= json_encode($toolComments) ?>, // 传递的数量数据
            backgroundColor: '#17a2b8', // 柱子的背景颜色
            borderColor: '#138496',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            // 在柱子上方显示数量标签
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ' + context.raw;
                    }
                }
            }
        },
        scales: {
            y: { // Y轴配置
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Comments Count' // 竖坐标标题
                }
                
            },
            x: { // X轴配置
                title: {
                    display: true,
                    text: 'Tool Name' // 横坐标标题
                }
            }
            
        },
        animation: {
            onComplete: function() {
                var chartInstance = this.chart;
                var ctx = chartInstance.ctx;
                ctx.font = Chart.helpers.fontString(12, 'bold', Chart.defaults.font.family);
                ctx.fillStyle = '#000';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';

                this.data.datasets.forEach(function(dataset, i) {
                    var meta = chartInstance.getDatasetMeta(i);
                    meta.data.forEach(function(bar, index) {
                        var data = dataset.data[index];
                        ctx.fillText(data, bar.x, bar.y - 5); // 在柱子上方显示数量
                    });
                });
            }
        }
    }
});
</script>


```



### 文献论坛管理（后端核心模块）

#### 功能介绍

对文献论坛中的评论点赞进行增删改查。

#### 界面展示

#### 代码实现

controller

```php+HTML
public function actionPaper()
    {
        // 获取所有的 Paper 数据
        $query = ArxivPaper::find();

        // 分页查询
        $pagination = new Pagination([
            'defaultPageSize' => 10,
            'totalCount' => $query->count(),
        ]);

        $papers = $query->offset($pagination->offset)
            ->limit($pagination->limit)
            ->all();

        // 渲染视图，并将数据传递给视图
        return $this->render('paper', [
            'papers' => $papers,
            'pagination' => $pagination,
        ]);
    }

public function actionViewPaperComments($id)
    {

        // 获取指定的论文信息
        $paper = ArxivPaper::findOne($id);
        // 调试日志：查看 $paper 的信息
        Yii::debug($paper, 'paper');
        Yii::info('This is an info message', 'category');
        if (!$paper) {
            throw new NotFoundHttpException('论文未找到');
        }
        if ($paper === null) {
            throw new \yii\web\NotFoundHttpException('The requested paper does not exist.');
        }
    
        // 获取与该论文相关的所有评论
        $comments = Comment::find()->where(['paper_id' => $id])->all();  // 通过 paper_id 获取评论
    
        // 渲染视图
        return $this->render('view-paper-comments', [
            'paper' => $paper,
            'comments' => $comments,  // 将评论数据传递到视图
        ]);
    }

public function actionUpdatePaperComment($id)
    {
        // 获取需要更新的 paper
        $comment = Comment::findOne($id);
        
        if (!$comment) {
            throw new NotFoundHttpException('The requested paper does not exist.');
        }
    
        // 创建表单提交的模型实例
        if ($comment->load(Yii::$app->request->post()) && $comment->save()) {
            // 保存成功后跳转到显示评论的页面（可以根据需求跳转到其他页面）
            return $this->redirect(['view-paper-comments', 'id' => $paper->id]);
        }
    
        // 渲染更新页面
        return $this->render('update-paper-comment', [
            'comment' => $comment,
        ]);
    }
    
    public function actionDeletePaperComment($id)
    {
        // 获取需要删除的评论
        $comment = Comment::findOne($id);
        
        if (!$comment) {
            // 如果没有找到该评论，抛出异常
            throw new NotFoundHttpException('The requested comment does not exist.');
        }
    
        // 获取该评论关联的论文 ID
        $paperId = $comment->paper_id;
    
        // 删除评论
        $comment->delete();
    
        // 重定向回该论文的评论页面
        return $this->redirect(['view-paper-comments', 'id' => $paperId]);
    }

 public function actionPaper()
    {
        // 获取所有的 Paper 数据
        $query = ArxivPaper::find();

        // 分页查询
        $pagination = new Pagination([
            'defaultPageSize' => 10,
            'totalCount' => $query->count(),
        ]);

        $papers = $query->offset($pagination->offset)
            ->limit($pagination->limit)
            ->all();

        // 渲染视图，并将数据传递给视图
        return $this->render('paper', [
            'papers' => $papers,
            'pagination' => $pagination,
        ]);
    }

    public function actionViewPaperLikes($id)
    {
        // 根据 Paper ID 获取对应的 Paper 信息
        $paper = ArxivPaper::findOne($id);
    
        if (!$paper) {
            throw new \yii\web\NotFoundHttpException('The requested paper does not exist.');
        }
    
        // 查询该论文的所有点赞记录
        $query = PaperLike::find()->where(['paper_id' => $id])->orderBy(['created_at' => SORT_DESC]);
    
        // 分页设置
        $pagination = new Pagination([
            'defaultPageSize' => 10,  // 每页显示 10 条记录
            'totalCount' => $query->count(),
        ]);
    
        // 获取分页后的点赞数据
        $paperLikes = $query->offset($pagination->offset)
                            ->limit($pagination->limit)
                            ->all();
    
        // 获取总点赞数
        $totalLikes = $query->count();
    
        // 渲染视图并传递数据
        return $this->render('view-paper-likes', [
            'paperLikes' => $paperLikes,
            'pagination' => $pagination,
            'paper' => $paper,
            'totalLikes' => $totalLikes,
        ]);
    }

    public function actionDeletePaperLike($id)
{
    $paperLike = PaperLike::findOne($id);

    if (!$paperLike) {
        throw new \yii\web\NotFoundHttpException('The requested like does not exist.');
    }

    // 删除该点赞记录
    if ($paperLike->delete()) {
        Yii::$app->session->setFlash('success', 'Like has been deleted.');
    } else {
        Yii::$app->session->setFlash('error', 'Failed to delete like.');
    }

    return $this->redirect(['view-paper-likes', 'id' => $paperLike->paper_id]);
}

```

model

```
class ArxivPaper extends ActiveRecord
{
    public static function tableName()
    {
        return 'arxiv_papers'; // 关联到 arxiv_papers 表
    }

    public function rules()
    {
        return [
            [['title', 'authors'], 'required'],
            [['title', 'authors'], 'string', 'max' => 255],
            [['abstract'], 'string'],
            [['published'], 'safe'],
        ];
    }


        // 确保在这里定义了正确的属性
    public function getAuthors()
    {
        return $this->authors;  // 如果字段名是 authors
    }

    
    public function getComments()
    {
        return $this->hasMany(Comment::class, ['paper_id' => 'id']);
    }

}

class Comment extends ActiveRecord
{
    public static function tableName()
    {
        return 'comment'; // 关联到 comments 表
    }

    public function rules()
    {
        return [
            [['paper_id', 'user_id', 'content'], 'required'],
            [['paper_id', 'user_id'], 'integer'],
            [['content'], 'string'],
            [['created_at'], 'safe'],
        ];
    }

    public function getPaper()
    {
        return $this->hasOne(ArxivPaper::class, ['id' => 'paper_id']);
    }
    

    public function getUser()
    {
        return $this->hasOne(User::class, ['id' => 'user_id']);
    }
}

class PaperLike extends ActiveRecord
{
    public static function tableName()
    {
        return 'paper_likes'; // 关联到 comments 表
    }

    public function rules()
    {
        return [
            [['paper_id', 'user_id'], 'required'],
            [['paper_id', 'user_id'], 'integer'],
            [['created_at'], 'safe'],
        ];
    }

    public function getPaper()
    {
        return $this->hasOne(ArxivPaper::class, ['id' => 'paper_id']);
    }

    public function getUser()
    {
        return $this->hasOne(User::class, ['id' => 'user_id']);
    }

    
}
```

view

```php+HTML
<h1><?= Html::encode($this->title) ?></h1>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Paper Title</th>
            <th>Author</th>
            <th>Published At</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($papers as $paper): ?>
            <tr>
                <td><?= Html::encode($paper->title) ?></td>
                <td><?= Html::encode($paper->authors) ?></td>
                <td><?= Yii::$app->formatter->asDatetime($paper->published, 'php:Y-m-d') ?></td>
                <td>
                    <!-- 查看评论按钮 -->

                    <?= Html::a('View Comments', ['comment/view-paper-comments', 'id' => $paper->id], ['class' => 'btn btn-primary']) ?>
                </td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>


//update-paper-comment.php
<h1><?= Html::encode($this->title) ?></h1>

<?php $form = ActiveForm::begin([
    'id' => 'update-paper-form',
    'action' => ['comment/update-paper-comment', 'id' => $comment->paper_id],  // 确保正确的 action
    'enableAjaxValidation' => false, // 不启用AJAX验证
    'options' => ['class' => 'form-horizontal'],
]); ?>


    <?= $form->field($comment, 'content')->textarea(['rows' => 6, 'placeholder' => 'Update paper description here']) ?>

    <div class="form-group">
        <?= Html::submitButton('Save', ['class' => 'btn btn-success']) ?>
    </div>

<?php ActiveForm::end(); ?>

//view-paper-comments.php
<h1><?= Html::encode($this->title) ?></h1>

<div class="paper-comments">
    <h2>Paper Information</h2>
    <p><strong>Title:</strong> <?= Html::encode($paper->title) ?></p>
    <p><strong>Authors:</strong> <?= Html::encode($paper->authors) ?></p>
    <p><strong>Abstract:</strong> <?= Html::encode($paper->abstract) ?></p>
    <p><strong>Published Date:</strong> <?= Yii::$app->formatter->asDatetime($paper->published, 'php:Y-m-d') ?></p>

    <h2>Comments</h2>
    <?php if (empty($comments)): ?>
        <p>No comments yet for this paper.</p>
    <?php else: ?>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Comment</th>
                    <th>User</th> <!-- 添加用户信息列 -->
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($comments as $comment): ?>
                    <tr>
                        <td><?= Html::encode($comment->content) ?></td>

                        <!-- 显示评论的用户 -->
                        <td>
                            <?php 
                                // 获取评论的用户信息
                                $user = User::findOne($comment->user_id); 
                                if ($user) {
                                    echo Html::encode($user->username);  // 显示用户名
                                } else {
                                    echo 'Unknown User';  // 如果没有找到用户，显示为 "Unknown User"
                                }
                            ?>
                        </td>

                        <td><?= Yii::$app->formatter->asDatetime($comment->created_at, 'php:Y-m-d H:i:s') ?></td>
                        <td>
                            <!-- 编辑评论按钮 -->
                            <?= Html::a('Edit', ['comment/update-paper-comment', 'id' => $comment->id], ['class' => 'btn btn-warning']) ?>

                            <!-- 删除评论按钮 -->
                            <?= Html::a('Delete', ['comment/delete-paper-comment', 'id' => $comment->id], [
                                'class' => 'btn btn-danger',
                                'data' => [
                                    'confirm' => 'Are you sure you want to delete this comment?',
                                    'method' => 'post',
                                ],
                            ]) ?>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    <?php endif; ?>
</div>
```



### 工具论坛管理（后端核心模块）

#### 功能介绍

对工具论坛中的评论和点赞进行增删改查。

#### 界面展示

#### 代码实现

controller

```
public function actionSelectType()
    {
        return $this->render('select-type');  // 渲染视图 select-type.php
    }

    // 显示 AI Tool 评论页面
    public function actionAiTool()
    {
        // 获取所有的 AI 工具数据
        $query = AllAiTool::find();
        
        // 分页查询
        $pagination = new Pagination([
            'defaultPageSize' => 10,
            'totalCount' => $query->count(),
        ]);

        $tools = $query->offset($pagination->offset)
            ->limit($pagination->limit)
            ->all();

        // 渲染视图，并将数据传递给视图
        return $this->render('ai-tool', [
            'tools' => $tools,
            'pagination' => $pagination,
        ]);
    }
    
    public function actionViewComments($toolName)
    {
        // 查找指定的 AI Tool
        $tool = AllAiTool::findOne(['AI Tool Name' => $toolName]);

        if ($tool === null) {
            throw new NotFoundHttpException('Tool not found.');
        }

        // 获取评论数据
        $query = ToolComment::find()->where(['tool_name' => $toolName]);

        // 分页查询
        $pagination = new Pagination([
            'defaultPageSize' => 10,
            'totalCount' => $query->count(),
        ]);

        $comments = $query->offset($pagination->offset)
                        ->limit($pagination->limit)
                        ->all();

        return $this->render('view-comments', [
            'tool' => $tool,
            'comments' => $comments,
            'pagination' => $pagination,
        ]);
    }
    
     // 删除评论
    public function actionDeleteComment($id)
    {
        $comment = ToolComment::findOne($id);
        if ($comment) {
            $comment->delete();
        }

        // 返回到评论页面
        return $this->redirect(['comment/view-comments', 'id' => $comment->ai_tool_id]);
    }

    // 更新评论页面
    public function actionUpdateComment($id)
    {
        $comment = ToolComment::findOne($id);
        
        if (!$comment) {
            throw new NotFoundHttpException('The requested comment does not exist.');
        }

        if ($comment->load(Yii::$app->request->post()) && $comment->save()) {
            // 更新成功后重定向回评论列表页
            return $this->redirect(['view-comments', 'toolName' => $comment->tool_name]);
        }

        return $this->render('update-comment', [
            'comment' => $comment,
        ]);
    }
    
    public function actionSelectType()
    {
        return $this->render('select-type');  // 渲染视图 select-type.php
    }

        // 显示 AI Tool 评论页面
        public function actionAiTool()
        {
            // 获取所有的 AI 工具数据
            $query = AllAiTool::find();            
            // 分页查询
            $pagination = new Pagination([
                'defaultPageSize' => 10,
                'totalCount' => $query->count(),
            ]);
    
            $tools = $query->offset($pagination->offset)
                ->limit($pagination->limit)
                ->all();
    

                $searchModel = new AiToolSearch();  // 创建搜索模型
                $data = $searchModel->search(Yii::$app->request->queryParams);  // 获取搜索数据
                

            // 渲染视图，并将数据传递给视图
            return $this->render('ai-tool', [
                'tools' => $tools,
                'pagination' => $pagination,
            ]);
        }
        
         public function actionViewLikes($toolName)
        {
            // 根据 AI Tool Name 获取 AI 工具信息
            $tool = AllAiTool::find()->where(['AI Tool Name' => $toolName])->one();
        
            if (!$tool) {
                throw new \yii\web\NotFoundHttpException('The requested tool does not exist.');
            }
        
            // 查询点赞数据
            $query = ToolLike::find()->where(['tool_name' => $tool->getAttribute('AI Tool Name')])->orderBy(['created_at' => SORT_DESC]);
        
            // 设置分页
            $pagination = new Pagination([
                'defaultPageSize' => 10,
                'totalCount' => $query->count(),
            ]);
        
            // 获取分页后的数据
            $toolLikes = $query->offset($pagination->offset)
                               ->limit($pagination->limit)
                               ->all();
        
            // 获取总点赞数
            $totalLikes = $query->count();
        
            // 渲染视图并传递数据
            return $this->render('view-likes', [
                'toolLikes' => $toolLikes,
                'pagination' => $pagination,
                'tool' => $tool,
                'totalLikes' => $totalLikes,  // 传递总点赞数
            ]);
        }

public function actionDeleteLike($id)
{
    $like = ToolLike::findOne($id);
    if ($like) {
        $like->delete();
    }

    return $this->redirect(['view-likes', 'toolName' => $like->tool->getAttribute('AI Tool Name')]);
}


```

model

```php+HTML
class AiToolSearch extends AllAiTool
{
    public $toolName;  // 用于搜索的字段

    public function rules()
    {
        return [
            [['toolName'], 'safe'],  // 支持模糊查询
        ];
    }

    public function search($params)
    {
        $query = AllAiTool::find();

        // 加载查询参数
        $this->load($params);

        if (!$this->validate()) {
            return $this->getDataProvider($query);
        }

        // 处理搜索字段
        if ($this->toolName) {
            $query->andFilterWhere(['like', 'AI Tool Name', $this->toolName]);
        }

        return $this->getDataProvider($query);
    }

    private function getDataProvider($query)
    {
        return new ActiveDataProvider([
            'query' => $query,
            'pagination' => [
                'pageSize' => 10,  // 每页显示10条记录
            ],
        ]);
    }
}

class AllAiTool extends \yii\db\ActiveRecord
{
    public static function tableName()
    {
        return 'all_ai_tool';
    }

    public function rules()
    {
        return [
            [['aiToolName', 'Description'], 'required'],
            [['aiToolName'], 'unique'], // 添加唯一性验证
            [['Description', 'freePaidOther', 'useableFor', 'charges', 'review', 'toolLink', 'majorCategory'], 'safe'],
        ];
    }
        
    // 添加映射方法
    public function getAiToolName()
    {
        return $this->getAttribute('AI Tool Name'); // 映射数据库的字段名
    }

    public function setAiToolName($value)
    {
        $this->setAttribute('AI Tool Name', $value);
    }

    public function getFreePaidOther()
    {
        return $this->getAttribute('Free/Paid/Other');
    }

    public function setFreePaidOther($value)
    {
        $this->setAttribute('Free/Paid/Other', $value);
    }

     // Useable For 映射
    public function getUseableFor()
    {
        return $this->getAttribute('Useable For');
    }

    public function setUseableFor($value)
    {
        $this->setAttribute('Useable For', $value);
    }
    // Useable For 映射
    public function getToolLink()
    {
        return $this->getAttribute('Tool Link');
    }

    public function setToolLink($value)
    {
        $this->setAttribute('Tool Link', $value);
    }
    public function getMajorCategory()
    {
        return $this->getAttribute('Tool Link');
    }

    public function setMajorCategory($value)
    {
        $this->setAttribute('Major Category', $value);
    }

}

class ToolComment extends ActiveRecord
{
    // 绑定表名
    public static function tableName()
    {
        return 'tool_comments';  // 数据表名
    }

    // 定义规则
    public function rules()
    {
        return [
            [['tool_name', 'content'], 'required'],  // 确保 tool_name 和 content 字段必填
            [['tool_name'], 'string'],             // tool_name 必须是字符串
            [['content'], 'string'],              // content 必须是字符串
            [['created_at'], 'safe'],             // created_at 是安全的（日期字段）
        ];
    }

    // 定义字段标签
    public function attributeLabels()
    {
        return [
            'id' => 'ID',
            'tool_name' => 'Tool Name',
            'content' => 'Content',
            'created_at' => 'Created At',
            'user_id' => 'User ID', // 显示 User ID
        ];
    }

    // 与 User 表的关联关系
    public function getUser()
    {
        return $this->hasOne(User::class, ['id' => 'user_id']);  // 假设用户表是 User，关联 user_id
    }
}

class ToolLike extends ActiveRecord
{
    // 绑定表名
    public static function tableName()
    {
        return 'tool_likes';  // 数据表名
    }

    // 定义规则
    public function rules()
    {
        return [
            [['tool_name'], 'required'],  // 确保 tool_name 和 content 字段必填
            [['tool_name'], 'string'],             // tool_name 必须是字符串
            [['created_at'], 'safe'],             // created_at 是安全的（日期字段）
        ];
    }

    // 定义字段标签
    public function attributeLabels()
    {
        return [
            'id' => 'ID',
            'tool_name' => 'Tool Name',
            'created_at' => 'Created At',
            'user_id' => 'User ID', // 显示 User ID
        ];
    }

    // 与 User 表的关联关系
    public function getUser()
    {
        return $this->hasOne(User::class, ['id' => 'user_id']);  // 假设用户表是 User，关联 user_id
    }

    // 通过 tool_id 关联 AllAiTool
    public function getTool()
    {
        return $this->hasOne(AllAiTool::class, ['AI Tool Name' => 'tool_name']);
    }

}
```

view

```php+HTML
<h1><?= Html::encode($this->title) ?></h1>

<table class="table table-striped">
    <thead>
        <tr>
            <th>AI Tool Name</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($tools as $tool): ?>
            <tr>
                <!-- 使用 getAttribute() 获取 AI Tool Name -->
                <td><?= Html::encode($tool->getAttribute('AI Tool Name')) ?></td>
                <td><?= Html::encode($tool->Description) ?></td>
                <!-- <td>
                    <?= Html::a('Delete', ['delete-comment', 'toolName' => $tool->getAttribute('AI Tool Name')], [
                        'class' => 'btn btn-danger',
                        'data' => [
                            'confirm' => 'Are you sure you want to delete this comment?',
                            'method' => 'post',
                        ],
                    ]) ?>
                </td> -->
                <td>
                    <?= Html::a('View Comments', ['view-comments', 'toolName' => $tool->getAttribute('AI Tool Name')], [
                        'class' => 'btn btn-primary',
                    ]) ?>
                </td>

            </tr>
        <?php endforeach; ?>
    </tbody>
</table>

//select-type.php
<h1 class="text-center mb-5">Select Comment Type</h1>

<!-- 使用Flexbox并限制最大宽度来确保页面只在中间部分显示 -->
<div class="container d-flex justify-content-center align-items-center" style="max-width: 800px; margin: 0 auto; min-height: 100vh;">
    <div class="row w-100 justify-content-center">
        <!-- 左边卡片 -->
        <div class="col-md-6 col-lg-6 mb-4">
            <div class="card shadow-lg border-0">
                <div class="card-header text-white" style="background: #007bff; border-radius: 10px;">
                    <h5>AI Tool Comments</h5>
                </div>
                <div class="card-body">
                    <p style="color: white;">View and manage comments for AI tools.</p>
                    <a href="<?= \yii\helpers\Url::to(['comment/ai-tool']) ?>" class="btn btn-primary btn-block hover-btn">Go to AI Tool Comments</a>
                </div>
            </div>
        </div>

        <!-- 右边卡片 -->
        <div class="col-md-6 col-lg-6 mb-4">
            <div class="card shadow-lg border-0">
                <div class="card-header text-white" style="background: #28a745; border-radius: 10px;">
                    <h5>Paper Comments</h5>
                </div>
                <div class="card-body">
                    <p style="color: white;">View and manage comments for papers.</p>
                    <a href="<?= \yii\helpers\Url::to(['comment/paper']) ?>" class="btn btn-success btn-block hover-btn">Go to Paper Comments</a>
                </div>
            </div>
        </div>
    </div>
</div>


//update-comment.php
$this->title = 'Update Comment: ' . Html::encode($comment->id);
$this->params['breadcrumbs'][] = ['label' => 'Tool Comments', 'url' => ['view-comments']];
$this->params['breadcrumbs'][] = $this->title;
?>

<h1><?= Html::encode($this->title) ?></h1>

<?php $form = ActiveForm::begin([
    'id' => 'update-comment-form',
    'action' => ['comment/update-comment', 'id' => $comment->id],
    'enableAjaxValidation' => false, // 不启用AJAX验证
    'options' => ['class' => 'form-horizontal'],
]); ?>

    <?= $form->field($comment, 'content')->textarea(['rows' => 6, 'placeholder' => 'Update your comment here']) ?>

    <div class="form-group">
        <?= Html::submitButton('Save', ['class' => 'btn btn-success']) ?>
    </div>

<?php ActiveForm::end(); ?>

//view-comments.php
<h1><?= Html::encode($this->title) ?></h1>

<div class="tool-comments">
    <h2>Tool Information</h2>
    <p><strong>Tool Name:</strong> <?= Html::encode($tool->getAttribute('AI Tool Name')) ?></p>
    <p><strong>Description:</strong> <?= Html::encode($tool->Description) ?></p>

    <h2>Comments</h2>
    <?php if (empty($comments)): ?>
        <p>No comments yet for this tool.</p>
    <?php else: ?>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Comment</th>
                    <th>User</th> <!-- 添加一个列显示用户 -->
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($comments as $comment): ?>
                    <tr>
                        <td><?= Html::encode($comment->content) ?></td>

                        <!-- 显示评论的用户 -->
                        <td>
                            <?php 
                                // 获取评论的用户信息
                                $user = User::findOne($comment->user_id); 
                                if ($user) {
                                    echo Html::encode($user->username);  // 显示用户名
                                } else {
                                    echo 'Unknown User';  // 如果没有找到用户，显示为 "Unknown User"
                                }
                            ?>
                        </td>

                        <td><?= Yii::$app->formatter->asDatetime($comment->created_at, 'php:Y-m-d H:i:s') ?></td>
                        <td>
                            <!-- 编辑评论按钮 -->
                            <?= Html::a('Edit', ['comment/update-comment', 'id' => $comment->id], ['class' => 'btn btn-warning']) ?>

                            <!-- 删除评论按钮 -->
                            <?= Html::a('Delete', ['delete-comment', 'id' => $comment->id], [
                                'class' => 'btn btn-danger',
                                'data' => [
                                    'confirm' => 'Are you sure you want to delete this comment?',
                                    'method' => 'post',
                                ],
                            ]) ?>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    <?php endif; ?>
</div>

```



### 用户管理

#### 功能介绍

对用户和管理员进行增删改查。

#### 界面展示

#### 代码实现

controller

```php+HTML
class UserController extends Controller
{
    /**
     * 显示所有用户的管理页面
     * @return string
     */
    // 获取所有用户数据，选择需要的字段
   // Controller: UserController.php
    public function actionUserManagement()
    {
        // 获取所有用户数据，选择需要的字段
        $users = User::find()->select(['id', 'username', 'email', 'status'])->all();
        
        // 将用户数据传递给视图
        return $this->render('user-management', [
            'users' => $users
        ]);
    }

    
    /**
     * 显示单个用户的详细信息
     * @param int $id 用户 ID
     * @return string
     * @throws NotFoundHttpException 如果没有找到该用户
     */
    public function actionView($id)
    {
        $user = User::findOne($id);
        if (!$user) {
            throw new NotFoundHttpException('User not found');
        }

        return $this->render('view', ['user' => $user]);
    }

    /**
     * 更新用户信息
     * @param int $id 用户 ID
     * @return string|\yii\web\Response
     * @throws NotFoundHttpException 如果没有找到该用户
     */
    public function actionUpdate($id)
    {
        $user = User::findOne($id);
        if (!$user) {
            throw new NotFoundHttpException('User not found');
        }

        // 如果表单提交并且保存成功，重定向到用户详情页
        if ($user->load(Yii::$app->request->post()) && $user->save()) {
            Yii::$app->session->setFlash('success', 'User updated successfully');
            return $this->redirect(['view', 'id' => $user->id]);
        }

        return $this->render('update', ['user' => $user]);
    }

    /**
     * 删除用户
     * @param int $id 用户 ID
     * @return \yii\web\Response
     * @throws NotFoundHttpException 如果没有找到该用户
     */
    public function actionDelete($id)
    {
        $user = User::findOne($id);
        if (!$user) {
            throw new NotFoundHttpException('User not found');
        }

        $user->delete();
        Yii::$app->session->setFlash('success', 'User deleted successfully');
        return $this->redirect(['index']);
    }
}


```

model

```php+HTML
class Administor extends ActiveRecord implements IdentityInterface
{
    /**
     * {@inheritdoc}
     */
    public static function tableName()
    {
        return '{{%administor}}'; // 数据表名称
    }

    /**
     * {@inheritdoc}
     */
    public function rules()
    {
        return [
            [['administorname', 'password'], 'required'],
            ['administorname', 'unique'],
        ];
    }
    // 添加 getUsername 方法
    public function getUsername()
    {
        return $this->administorname;  // 返回 administorname
    }
    /**
     * 根据用户名查找用户
     */
    public static function findByUsername($administorname)
    {
        return self::findOne(['administorname' => $administorname]);
    }

    /**
     * 验证密码
     */
    public function validatePassword($password)
    {
        return $this->password === $password;  // 比较明文密码
    }

    /**
     * {@inheritdoc}
     */
    public static function findIdentity($id)
    {
        return self::findOne($id);
    }

    /**
     * {@inheritdoc}
     */
    public function getId()
    {
        return $this->getPrimaryKey();
    }

    /**
     * {@inheritdoc}
     */
    public function getAuthKey()
    {
        // 如果没有使用授权密钥，返回 null
        return null;
    }

    /**
     * {@inheritdoc}
     */
    public function validateAuthKey($authKey)
    {
        // 如果没有使用授权密钥，直接返回 false 或者返回 true 也可以
        return false;
    }

    /**
     * {@inheritdoc}
     */
    public static function findIdentityByAccessToken($token, $type = null)
    {
        return null;  // 如果不需要通过令牌查找用户，返回 null
    }
}

class LoginFormAdministor extends Model
{
    public $administorname;
    public $password;
    public $rememberMe = true;

    private $_administor = false;

    public function rules()
    {
        return [
            [['administorname', 'password'], 'required'],
            ['rememberMe', 'boolean'],
            ['administorname', 'string', 'max' => 255],
            ['password', 'validatePassword'],
        ];
    }

    // 验证密码
    public function validatePassword($attribute, $params)
    {
        if (!$this->hasErrors()) {
            $administor = $this->getAdministor();
            if (!$administor || !$administor->validatePassword($this->password)) {
                $this->addError($attribute, 'Incorrect administorname or password.');
            }
        }
    }

    // 根据用户名获取用户对象
    public function getAdministor()
    {
        if ($this->_administor === false) {
            $this->_administor = Administor::findByUsername($this->administorname);
        }
        return $this->_administor;
    }

    // 执行登录
    public function login()
    {
        if ($this->validate()) {
            return Yii::$app->user->login($this->getAdministor(), $this->rememberMe ? 3600 * 24 * 30 : 0);
        }
        return false;
    }
}
```

view

```php+HTML
// backend/views/user/update.php

<h1>Update User: <?= $user->username ?></h1>

<?php $form = \yii\widgets\ActiveForm::begin(); ?>

<?= $form->field($user, 'username') ?>
<?= $form->field($user, 'email') ?>
<?= $form->field($user, 'status')->dropDownList([1 => 'Active', 0 => 'Inactive']) ?>

<button class="btn btn-success">Save</button>

<?php \yii\widgets\ActiveForm::end(); ?>

<h1>User Management</h1>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($users as $user): ?>
            <tr>
                <td><?= Html::encode($user->id) ?></td>
                <td><?= Html::encode($user->username) ?></td>
                <td><?= Html::encode($user->email) ?></td>
                <td><?= $user->status == 0 ? 'Active' : 'Inactive' ?></td>
                <td>
                    <a href="<?= \yii\helpers\Url::to(['user/view', 'id' => $user->id]) ?>" class="btn btn-primary">View</a>
                    <a href="<?= \yii\helpers\Url::to(['user/update', 'id' => $user->id]) ?>" class="btn btn-warning">Update</a>
                    <a href="<?= \yii\helpers\Url::to(['user/delete', 'id' => $user->id]) ?>" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
                </td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>
```



#### 









